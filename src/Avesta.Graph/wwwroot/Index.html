<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="Index.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>

<body>

  <!-- 
  <ul id="myUL">
    <li><span class="caret">Beverages</span>
      <ul class="nested">
        <li>Water</li>
        <li>Coffee</li>
        <li><span class="caret">Tea</span>
          <ul class="nested">
            <li>Black Tea</li>
            <li>White Tea</li>
            <li><span class="caret">Green Tea</span>
              <ul class="nested">
                <li>Sencha</li>
                <li>Gyokuro</li>
                <li>Matcha</li>
                <li>Pi Lo Chun</li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul> -->


  <div class="row">
    <div class="col-md-3">
      <button onclick="toggleTypes()" class="btn btn-primary ml-1">Toggle Types</button>
    </div>
  </div>

  <div class="row">
    <div id="hierarchy-container" class="mt-5"></div>
  </div>


  <script src="jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
  </script>




  <script>
    class BaseModel {
      CreatedDate;
      ID;
      ModifiedDate;
      DeletedDate;
      IsLock;

      constructor(obj) {
        obj && Object.assign(this, obj)
      }
    }

    class AvestaGraphModel extends BaseModel {
      constructor(obj) {
        super(obj)
        obj && Object.assign(this, obj)
      }
    }

    class BasicInformation extends AvestaGraphModel {
      Name;
      FullName;
      Type;

      constructor(obj) {
        super(obj)
        obj && Object.assign(this, obj)
      }

    }

    class EntityInformation extends BasicInformation {
      Properties;
      constructor(obj) {
        super(obj)

        let lstemp = []
        for (let i = 0; i < obj['Properties'].length; i++) {
          var model = new PropertyInformation(obj.Properties[i])
          lstemp[i] = model
        }
        this.Properties = lstemp;

        obj && Object.assign(this, obj)
      }
    }

    class PropertyInformation extends BasicInformation {
      constructor(obj) {
        super(obj)
        obj && Object.assign(this, obj)
      }
    }

    class DataHierarchy extends BasicInformation {
      Entities;
      constructor(obj) {
        super(obj)

        let lstemp = []
        for (let i = 0; i < obj['Entities'].length; i++) {
          var model = new EntityInformation(obj.Entities[i])
          lstemp[i] = model
        }
        this.Entities = lstemp;


        obj && Object.assign(this, obj)
      }
    }



    let hide = false

    function toggleTypes() {
      var els = document.getElementsByClassName("type");
      Array.from(els).forEach(function (el) {
        if (!hide) {
          el.style.display = 'none'

        } else {
          el.style.display = ''
        }
      });
      hide = !hide;
    }




    function toggle() {
      var toggler = document.getElementsByClassName("caret");
      var i;

      for (i = 0; i < toggler.length; i++) {
        toggler[i].addEventListener("click", function () {
          this.parentElement.querySelector(".nested").classList.toggle("active");
          this.classList.toggle("caret-down");
        });
      }
    }



    function getConfig() {
      $.ajax('https://localhost:7194/avesta/graph/graph.json').done((response) => {
        var hierarchy = new DataHierarchy(JSON.parse(response));
        var result = initHierarchy(hierarchy);
        $("#hierarchy-container").html(result)
        toggle();
      })
    }



    function initProperty(property) {
      var result = `<li>${property.Name} <a class='prop-type type' href='#'>: ${property.Type}</a></li>`;
      return result;
    }

    function initEntity(entity) {

      let props = '';

      entity.Properties.forEach(p => {
        props += initProperty(p)
      })

      var data = `
  <ul class="myUL" id='${uuidv4()}'>
    <li><span class="caret">${entity.Name} <a class='prop-type type' href='#'>: ${entity.Type}</a></span>
      <ul class="nested">
        ${props}
      </ul>
    </li>
  </ul>
`

      return data;
    }

    function initHierarchy(hierarchy) {
      let result = '';

      (hierarchy.Entities).forEach(entity => {
        result += initEntity(entity)
      });

      return result;
    }


    function uuidv4() {
      return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );
    }

    getConfig()
  </script>


</body>

</html>